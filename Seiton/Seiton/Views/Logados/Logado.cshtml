@{
    ViewData["Title"] = "Logado";
}

@model ViewModel
<link rel="stylesheet" type="text/css" href="/css/Logado.css" media="screen" />

<div class="Container">
    
    <div class="side-bar-background">
        <div class="white-blue">
            <h1>Projetos</h1>
            <ul>
                @foreach (var projeto in Model.Nome_projeto.Zip(Model.ProjetoId, (nomeProjeto, ProjetoId) => new { NomeProjeto = nomeProjeto, ProjetoId = ProjetoId }))
                {
                    <li>
                        <a class="project-name" asp-area="" asp-route-id="@projeto.ProjetoId">@projeto.NomeProjeto</a>
                        <a asp-area="" asp-controller="Projetos" asp-action="Edit" asp-route-id="@projeto.ProjetoId"><img src="/img/edit.png" class="foto-buttons" /></a>
                        <a asp-area="" asp-controller="Projetos" asp-action="Delete" asp-route-id="@projeto.ProjetoId"><img src="/img/delete.png" class="foto-buttons" /></a>
                    </li>
                }
                
            </ul>
            <div class="adicionar">
                <span class="material-symbols-outlined">add</span>
                <a asp-controller="Projetos" asp-action="Create">Novo</a>
            </div>
            <hr />
        </div>
    </div>

    <div class="Container_Body">
            @if (User.Identity.IsAuthenticated)
            {
                <h1 class="project-name-dropdown">@ViewData["userName"]</h1>

            <div class="dropdown" onclick="joaquim()">
                    <img class="dropdown-image" src="/img/man.png" alt="Imagem de Menu">
                    <div class="dropdown-content">
                        <button class="nav-link text-dark" asp-area="" onclick="ModalOpen(@ViewData["userId"], '/Usuarios/Edit/')">Editar</button>
                        <button class="nav-link text-dark" asp-area="" onclick="ModalOpen(@ViewData["userId"], '/Usuarios/Delete/')">Apagar</button>
                        <a class="nav-link text-dark" asp-area="" asp-controller="Usuarios" asp-action="Logout">Sair</a>
                    </div>
                </div>
            }

        <div class="info_container">
            <h1>Projeto:</h1>
            <h4>@ViewData["NomeProjeto"]</h4>

        </div>

        <div class="colum_container">
            
            @if (Model.NomeColuna != null)
            {
                var c = 0;
                var colunas = Model.NomeColuna.Zip(Model.IdColuna, (nomecoluna, idcoluna) => new { NomeColuna = nomecoluna, IdColuna = idcoluna })
                .Zip(Model.CorColuna, (coluna, cor) => new { NomeColuna = coluna.NomeColuna, IdColuna = coluna.IdColuna, CorColuna = cor });

                @foreach (var Coluna in colunas)
                {
                    <div class="columContainerInt">
                    
                        <div class="coluna">
                            <div class="color_colum" style="background-color: @Coluna.CorColuna;"><div class="icolor_colum"></div></div>
                            <h3>@Coluna.NomeColuna</h3>
                            <a asp-area="" asp-controller="Colunas" asp-action="Edit" asp-route-id="@Coluna.IdColuna"><img src="/img/edit.png" class="foto-buttons" /></a>
                            <button type="button" id="openModalBtn" onclick="ModalOpen(@Coluna.IdColuna, '/Colunas/Edit/')">Modal</button>

                            
                        </div>
                            @if (c == 0)
                            {
                                <div id="adicionarTarefa" >
                                    <span class="material-symbols-outlined">
                                        add
                                    </span>
                                    <a asp-area="" asp-controller="Tarefas" asp-action="Create">Nova tarefa</a>
                                </div>
                            }
                            
                            @foreach (var IdTarefa in Model.IdTarefa)
                            {
                                var tarefasCombinadas = Model.NomeTarefas.Zip(Model.descricao, (nomeTarefa, desc) => new { NomeTarefa = nomeTarefa, Descricao = desc })
                                .Zip(Model.Responsavel, (tarefa, resp) => new { NomeTarefa = tarefa.NomeTarefa, Descricao = tarefa.Descricao, Responsavel = resp });

                                @if (@Coluna.IdColuna == IdTarefa)
                                {
                                    foreach (var tarefa in tarefasCombinadas)
                                    {
                                        <div class="tarefa">
                                        <h4>@tarefa.Responsavel</h4>
                                        <div class="paragrafo2">
                                            <h2>@tarefa.NomeTarefa</h2>
                                        </div>
                                        <hr>
                                        <div class="paragrafo"><p>@tarefa.Descricao</p></div>
                                        </div>
                                    }
                                }
                                break;
                            }
                    </div>

                    c = 1;
                }
            }
        </div>
    </div>

    <!-- Modal -->
    <div id="myModalE" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModalBtn">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

</div>
